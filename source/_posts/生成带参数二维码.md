title: 微信生成带参数的二维码
date: 2015-11-18 21:46:45
tags:
- 微信
- 前端
categories:
- 技术
---
> 为了满足用户渠道推广分析的需要，公众平台提供了生成带参数二维码的接口。使用该接口可以获得多个带
不同场景值的二维码，用户扫描后，公众号可以接收到事件推送。

该接口实际上是生成一个公众号的二维码，只不过该二维码上带有开发者自定义的场景参数，微信用户在扫
该二维码的时候会转到对应的公众号，开发者能够在接受实践推送服务中接收到`该用户本次扫码的事件`,
并且能够接受到本次扫码中的自定义场景参数。

## 目前有的两种类型的二维码:
> 1. 临时二维码，是有过期时间的，最长可以设置为在二维码生成后的7天（即604800秒）后过期，但能
够生成较多数量。临时二维码主要用于帐号绑定等不要求二维码永久保存的业务场景
2. 永久二维码，是无过期时间的，但数量较少（目前为最多10万个）。永久二维码主要用于适用于帐号
绑定、用户来源统计等场景。

## 会产生的两种事件推送类型:
> 1. 如果用户还未关注公众号，则用户可以关注公众号，关注后微信会将带场景值关注事件推送给开发者。
2. 如果用户已经关注公众号，则微信会将带场景值扫描事件推送给开发者。

### 未关注数据包
| *参数* | *描述* |
|-------|--------|
|ToUserName|   开发者微信号|
|FromUserName|	发送方帐号（一个OpenID）|
|CreateTime|	消息创建时间 （整型）|
|MsgType|	    消息类型，event|
|Event|	        事件类型，subscribe|
|EventKey|	    事件KEY值，qrscene_为前缀，后面为二维码的参数值|
|Ticket|	    二维码的ticket，可用来换取二维码图片|

### 已经关注数据包
| *参数* | *描述* |
|-------|--------|
|ToUserName|   开发者微信号|
|FromUserName|	发送方帐号（一个OpenID）|
|CreateTime|	消息创建时间 （整型）|
|MsgType|	    消息类型，event|
|Event|	        事件类型，SCAN|
|EventKey|	    事件KEY值，是一个32位无符号整数，即创建二维码时的二维码scene_id|
|Ticket|	    二维码的ticket，可用来换取二维码图片|

## 生成流程
总共有两部流程：
1. 根据请求参数，微信返回生成的二维码链接和本二维码转化为图片的ticket
2. 根据二维码链接和ticket，让微信来帮忙生成一张二维码图片（如果有自己的二维码转图片的服务，则
这一步可以省略)
>具体调用接口参数可以参考[官方文档](http://mp.weixin.qq.com/wiki/18/28fc21e7ed87bec960651f0ce873ef8a.html)
